# Energy Services and Products

```{r eval=FALSE}
## ---- ++++ ENERGY SERVICES ++++ ----

  swlatex(sw,"\\twocolumn")
  
  swlatex(sw,"\\section{Energy Services and Products}")
  
  ## Buildings
  items<- c(
    "FE|Buildings|non-Heating|Electricity|Conventional (EJ/yr)",
    "FE|Buildings|Heating|Electricity|Resistance (EJ/yr)",
    "FE|Buildings|Heating|Electricity|Heat pumps (EJ/yr)",
    "FE|Buildings|Heating|District Heating (EJ/yr)",
    "FE|Buildings|Heating|Solids (EJ/yr)",
    "FE|Buildings|Heating|Liquids (EJ/yr)",
    "FE|Buildings|Heating|Gases (EJ/yr)",
    "FE|Buildings|Heating|Hydrogen (EJ/yr)"
  )
  
  if(all(c(items) %in% getNames(data,dim=3))){
    
    swlatex(sw,"\\subsection{Buildings}")
    
    tot <-"FE|Buildings (EJ/yr)"
    
    var <- data[,,intersect(items,getNames(data,dim=3))]
    
    p <- mipArea(var[mainReg,,],total=data[mainReg,,tot],scales="free_y")
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=3.5,width=7")
    
    p <- mipBarYearData(var[mainReg,y_bar,])
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=4.5,width=7")
    
    p <- mipBarYearData(var[,y_bar,][mainReg,,,invert=TRUE]) +
      guides(fill=guide_legend(ncol=3))
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    swlatex(sw,"\\onecolumn")
    p <- mipArea(var[mainReg,,,invert=TRUE],total=data[,,tot][mainReg,,,invert=TRUE],scales="free_y")
    swfigure(sw,print,p,sw_option="height=8,width=16")
    swlatex(sw,"\\twocolumn")
  
  }
  
  ## Transport
  
  items<- c(
    "ES|Transport|Pass (bn pkm/yr)",
    "ES|Transport|Pass|Road|LDV (bn pkm/yr)",
    "ES|Transport|Pass|non-LDV (bn pkm/yr)",
    "ES|Transport|Freight (bn tkm/yr)"
  )
  
  if(all(c(items) %in% getNames(data,dim=3))){
    
    swlatex(sw,"\\subsection{Transport}")
  
    swlatex(sw,"\\onecolumn")
  
    ## ---- ES passenger transport per capita (time domain, line graph)----
  
    swlatex(sw,"\\subsubsection{Energy Services for Passenger Transport (per Capita, year)}")
     
    items<- c(
      "ES|Transport|Pass (bn pkm/yr)",
      "ES|Transport|Pass|Road|LDV (bn pkm/yr)",
      "ES|Transport|Pass|non-LDV (bn pkm/yr)"
    )
    
    p <- lineplots_perCap(data, items, 1e3, "Mobility Demand per Cap. [km/yr]",
                          global = T, per_gdp = F)
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    p <- lineplots_perCap(data, items, 1e3, "Mobility Demand per Cap. [km/yr]",
                          global = F, per_gdp = F)
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    
    ## ---- ES passenger transport per capita (GDP domain, line graph)----
    
    swlatex(sw,"\\subsubsection{Energy Services for Passanger Transport (per Capita, GDP)}")
    
    p <- lineplots_perCap(data, items, 1e3, "Mobility Demand per Cap. [km/yr]",
                          global = T, per_gdp = T)
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    p <- lineplots_perCap(data, items, 1e3, "Mobility Demand per Cap. [km/yr]",
                          global = F, per_gdp = T)
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    
    
    ##---- ES passenger transport per capita (bar graph)----
    
    items <- c("ES|Transport|Pass|Road|LDV|BEV (bn pkm/yr)",
               "ES|Transport|Pass|Road|LDV|FCEV (bn pkm/yr)",
               "ES|Transport|Pass|Road|LDV|Gases (bn pkm/yr)",
               "ES|Transport|Pass|Road|LDV|Hybrid Electric (bn pkm/yr)",
               "ES|Transport|Pass|Road|LDV|Liquids (bn pkm/yr)")
    
    if(all(c(items) %in% getNames(data,dim=3))){
      var <- data[,,intersect(items,getNames(data,dim=3))]
      pop <- data[,,"Population (million)"]
      
      var_cap <- var/pop*1000  # in pkm/yr/cap
      
      swlatex(sw,"\\twocolumn")
      
      p <- mipBarYearData(var_cap[mainReg,y_bar,], 
                          ylab = "Mobility Demand for LDV per Capita [km/yr]")
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=4.5,width=7")
      
      p <- mipBarYearData(var_cap[,y_bar,][mainReg,,,invert=TRUE], 
                          ylab = "Mobility Demand for LDV per Capita [km/yr]") +
        guides(fill=guide_legend(ncol=3))
      swfigure(sw,print,p,sw_option="height=9,width=8")
      
      swlatex(sw,"\\onecolumn")
    }
    
   
    ## ---- ES freight transport per capita (time domain, line graph)----
    
    swlatex(sw,"\\subsubsection{Energy Services for Freight Transport (per Capita, year)}")
    
    p <- lineplots_perCap(data, "ES|Transport|Freight (bn tkm/yr)", 1e3, "Freight Demand per Cap. (tkm/yr)",
                          global = T, per_gdp = F)
    
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    p <- lineplots_perCap(data, "ES|Transport|Freight (bn tkm/yr)", 1e3, "Freight Demand per Cap. (tkm/yr)",
                          global = F, per_gdp = F)
    
    swfigure(sw,print,p,sw_option="height=9,width=16")

    ## ---- ES freight transport per capita (GDP domain, line graph)----
    
    swlatex(sw,"\\subsubsection{Energy Services for Freight Transport (per Capita, GDP)}")
    
    p <- lineplots_perCap(data, "ES|Transport|Freight (bn tkm/yr)", 1e3, "Freight Demand per Cap. (tkm/yr)",
                          global = T, per_gdp = T)
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    p <- lineplots_perCap(data, "ES|Transport|Freight (bn tkm/yr)", 1e3, "Freight Demand per Cap. (tkm/yr)",
                          global = F, per_gdp = T)
    
    swfigure(sw,print,p,sw_option="height=9,width=16")
    
    
    ##---- ES freight transport per capita (bar graph)----
    
    items <- c("ES|Transport|Freight|Road|Electric (bn tkm/yr)",
               "ES|Transport|Freight|Road|FCEV (bn tkm/yr)",
               "ES|Transport|Freight|Road|Gases (bn tkm/yr)",
               "ES|Transport|Freight|Road|Liquids (bn tkm/yr)")
    
    if(all(c(items) %in% getNames(data,dim=3))){
      var <- data[,,intersect(items,getNames(data,dim=3))]
      pop <- data[,,"Population (million)"]
      
      var_cap <- var/pop*1000  # in tkm/yr/cap
      
      swlatex(sw,"\\twocolumn")
      
      p <- mipBarYearData(var_cap[mainReg,y_bar,], 
                          ylab = "Mobility Demand for Trucks per Capita (tkm/yr/cap)")
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=4.5,width=7")
      
      p <- mipBarYearData(var_cap[,y_bar,][mainReg,,,invert=TRUE], 
                          ylab = "Mobility Demand for Trucks per Capita (tkm/yr/cap)") +
          guides(fill=guide_legend(ncol=3))
      swfigure(sw,print,p,sw_option="height=9,width=8")
      
    }
  }
    
    swlatex(sw,"\\twocolumn")
    
    # Vehicles Stock
    
    items<- c(
      "Est LDV Stock (million vehicles)",
      "Est EV LDV Stock (million vehicles)",
      "Est H2 LDV Stock (million vehicles)",
      "Est ICE LDV Stock (million vehicles)"
    )
    
    
    if (all(c(items) %in% getNames(data,dim=3))){
    
      swlatex(sw,"\\subsubsection{LDV Vehicles Stock}")
      
      tot <-"Est LDV Stock (million vehicles)"
      
      items <- c("Est EV LDV Stock (million vehicles)",
                 "Est H2 LDV Stock (million vehicles)",
                 "Est ICE LDV Stock (million vehicles)")
      var <- data[,,intersect(items,getNames(data,dim=3))]
      
      swlatex(sw,"\\twocolumn")
      
      p <- mipArea(var[mainReg,,],total=data[mainReg,,tot],scales="free_y")
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=3.5,width=7")
      
      p <- mipBarYearData(var[mainReg,y_bar,])
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=4.5,width=7")
      
      p <- mipBarYearData(var[,y_bar,][mainReg,,,invert=TRUE]) +
        guides(fill=guide_legend(ncol=3))
      swfigure(sw,print,p,sw_option="height=9,width=8")
      
      swlatex(sw,"\\onecolumn")
      p <- mipArea(var[mainReg,,,invert=TRUE],total=data[,,tot][mainReg,,,invert=TRUE],scales="free_y")
      swfigure(sw,print,p,sw_option="height=8,width=16")
      swlatex(sw,"\\twocolumn")
    }
    
    # Sales
      
    items <- c(      
      "Est LDV Sales (million vehicles)",
      "Est EV LDV Sales (million vehicles)",
      "Est H2 LDV Sales (million vehicles)",
      "Est ICE LDV Sales (million vehicles)"
      )
      
    if (all(c(items) %in% getNames(data,dim=3))){
    
      swlatex(sw,"\\subsubsection{LDV Vehicles Sales}")
      
      tot <-    "Est LDV Sales (million vehicles)"
      
      items <- c("Est EV LDV Sales (million vehicles)",
                 "Est H2 LDV Sales (million vehicles)",
                 "Est ICE LDV Sales (million vehicles)")
      var <- data[,,intersect(items,getNames(data,dim=3))]
      
      p <- mipArea(var[mainReg,,],total=data[mainReg,,tot],scales="free_y")
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=3.5,width=7")
      
      p <- mipBarYearData(var[mainReg,y_bar,])
      p <- p + theme(legend.position="none")
      swfigure(sw,print,p,sw_option="height=4.5,width=7")
      
      p <- mipBarYearData(var[,y_bar,][mainReg,,,invert=TRUE]) +
        guides(fill=guide_legend(ncol=3))
      swfigure(sw,print,p,sw_option="height=9,width=8")
      
      swlatex(sw,"\\onecolumn")
      p <- mipArea(var[mainReg,,,invert=TRUE],total=data[,,tot][mainReg,,,invert=TRUE],scales="free_y")
      swfigure(sw,print,p,sw_option="height=8,width=16")
      swlatex(sw,"\\twocolumn")    
      
    }

  ## ---- non-LDV ----
  
  items<- c(
    "Services and Products|Transport|non-LDV|Stock|uedit (NA)",
    "Services and Products|Transport|non-LDV|Stock|apCarDiT (NA)",
    "Services and Products|Transport|non-LDV|Stock|apcarDiEffT (NA)",
    "Services and Products|Transport|non-LDV|Stock|apcarDiEffH2T (NA)",
    "Services and Products|Transport|non-LDV|Sales|uedit (NA)",
    "Services and Products|Transport|non-LDV|Sales|apCarDiT (NA)",
    "Services and Products|Transport|non-LDV|Sales|apcarDiEffT (NA)",
    "Services and Products|Transport|non-LDV|Sales|apcarDiEffH2T (NA)"
  )
  
  if(all(c(items) %in% getNames(data,dim=3))){
    
    # Freight Vehicles Stock
    
    swlatex(sw,"\\subsubsection{non-LDV Vehicles Stock}")
    
    tot <-"Services and Products|Transport|non-LDV|Stock|uedit (NA)"
    
    items <- c("Services and Products|Transport|non-LDV|Stock|apCarDiT (NA)",
               "Services and Products|Transport|non-LDV|Stock|apcarDiEffT (NA)",
               "Services and Products|Transport|non-LDV|Stock|apcarDiEffH2T (NA)")
    var <- data[,,intersect(items,getNames(data,dim=3))]
    
    p <- mipArea(var[mainReg,,],total=data[mainReg,,tot],scales="free_y")
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=3.5,width=7")
    
    p <- mipBarYearData(var[mainReg,y_bar,])
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=4.5,width=7")
    
    p <- mipBarYearData(var[,y_bar,][mainReg,,,invert=TRUE]) +
      guides(fill=guide_legend(ncol=3))
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    swlatex(sw,"\\onecolumn")
    p <- mipArea(var[mainReg,,,invert=TRUE],total=data[,,tot][mainReg,,,invert=TRUE],scales="free_y")
    swfigure(sw,print,p,sw_option="height=8,width=16")
    swlatex(sw,"\\twocolumn")
    
    # HDV Sales
    
    swlatex(sw,"\\subsubsection{non-LDV Vehicles Sales}")
    
    tot <-    "Services and Products|Transport|non-LDV|Sales|uedit (NA)"
    
    items <- c("Services and Products|Transport|non-LDV|Sales|apCarDiT (NA)",
               "Services and Products|Transport|non-LDV|Sales|apcarDiEffT (NA)",
               "Services and Products|Transport|non-LDV|Sales|apcarDiEffH2T (NA)")
    var <- data[,,intersect(items,getNames(data,dim=3))]
    
    p <- mipArea(var[mainReg,,],total=data[mainReg,,tot],scales="free_y")
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=3.5,width=7")
    
    p <- mipBarYearData(var[mainReg,y_bar,])
    p <- p + theme(legend.position="none")
    swfigure(sw,print,p,sw_option="height=4.5,width=7")
    
    p <- mipBarYearData(var[,y_bar,][mainReg,,,invert=TRUE]) +
      guides(fill=guide_legend(ncol=3))
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    swlatex(sw,"\\onecolumn")
    p <- mipArea(var[mainReg,,,invert=TRUE],total=data[,,tot][mainReg,,,invert=TRUE],scales="free_y")
    swfigure(sw,print,p,sw_option="height=8,width=16")
    swlatex(sw,"\\twocolumn")    
    
  }
  
  ## ---- Industry Production ----
  
  items <- c(
    "Production|Industry|Steel (Mt/yr)",
    "Production|Industry|Steel|Primary (Mt/yr)",
    "Production|Industry|Steel|Secondary (Mt/yr)",
    "Production|Industry|Cement (Mt/yr)",
    "Value Added|Industry|Chemicals (billion US$2005/yr)"
  )
  
  swlatex(sw, "\\subsection{Industry Production}")
  
  if(all(c(items) %in% magclass::getNames(data,dim=3))){
    
    swlatex(sw, "\\subsubsection{per sector}")
    
    p <- mipLineHistorical(data[mainReg,,"Production|Industry|Steel (Mt/yr)"],x_hist=histData_NA[mainReg,,"Production|Industry|Steel (Mt/yr)"],
                           ylab='Production|Industry|Steel [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Production|Industry|Steel (Mt/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Production|Industry|Steel (Mt/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab='Production|Industry|Steel [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    p <- mipLineHistorical(data[mainReg,,"Production|Industry|Steel|Primary (Mt/yr)"],x_hist=histData_NA[mainReg,,"Production|Industry|Steel|Primary (Mt/yr)"],
                           ylab='Production|Industry|Steel|Primary [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Production|Industry|Steel|Primary (Mt/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Production|Industry|Steel|Primary (Mt/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab='Production|Industry|Steel|Primary [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    p <- mipLineHistorical(data[mainReg,,"Production|Industry|Steel|Secondary (Mt/yr)"],x_hist=histData_NA[mainReg,,"Production|Industry|Steel|Secondary (Mt/yr)"],
                           ylab='Production|Industry|Steel|Secondary [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Production|Industry|Steel|Secondary (Mt/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Production|Industry|Steel|Secondary (Mt/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab='Production|Industry|Steel|Secondary [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    p <- mipLineHistorical(data[mainReg,,"Production|Industry|Cement (Mt/yr)"],x_hist=histData_NA[mainReg,,"Production|Industry|Cement (Mt/yr)"],
                           ylab='Production|Industry|Cement [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Production|Industry|Cement (Mt/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Production|Industry|Cement (Mt/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab='Production|Industry|Cement [Mt/yr]',scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    p <- mipLineHistorical(data[mainReg,,"Value Added|Industry|Chemicals (billion US$2005/yr)"],x_hist=histData_NA[mainReg,,"Value Added|Industry|Chemicals (billion US$2005/yr)"],
                           ylab="Value Added|Industry|Chemicals [billion US$2005/yr]",scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Value Added|Industry|Chemicals (billion US$2005/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Value Added|Industry|Chemicals (billion US$2005/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab="Value Added|Industry|Chemicals [billion US$2005/yr]",scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
    
    
    p <- mipLineHistorical(data[mainReg,,"Value Added|Industry|Other Industry (billion US$2005/yr)"],x_hist=histData_NA[mainReg,,"Value Added|Industry|other (billion US$2005/yr)"],
                           ylab="Value Added|Industry|Other Industry [billion US$2005/yr]",scales="free_y",plot.priority=c("x_hist","x","x_proj"))
    swfigure(sw,print,p,sw_option="height=8,width=8")
    p <- mipLineHistorical(data[,,"Value Added|Industry|Other Industry (billion US$2005/yr)"][mainReg,,,invert=TRUE],x_hist=histData_NA[,,"Value Added|Industry|other (billion US$2005/yr)"][c(mainReg, "GLO"),,,invert=TRUE],
                           ylab="Value Added|Industry|Other Industry [billion US$2005/yr]",scales="free_y",plot.priority=c("x_hist","x","x_proj"),facet.ncol=3)
    swfigure(sw,print,p,sw_option="height=9,width=8")
  }
  
```

